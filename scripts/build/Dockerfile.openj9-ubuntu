FROM docker.io/library/ibm-semeru-runtimes:open-11-jdk-jammy
ARG CC=gcc

RUN mkdir -p /etc/criu && echo 'ghost-limit 16777216' > /etc/criu/default.conf
COPY . /criu
WORKDIR /criu

RUN contrib/apt-install maven "$CC" && contrib/dependencies/apt-packages.sh

RUN make mrproper && make -j $(nproc) CC="$CC"

ENTRYPOINT ["mvn", "-f", "test/javaTests/pom.xml", "test"]
